
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Creating Polymorphic Users With Devise and Rails - Code by Codes</title>
  <meta name="author" content="Cody Norman">

  
  <meta name="description" content="Creating Polymorphic Users With Devise and Rails written May 30, 2016 Add in links for an updated template to start the project with. create &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.codebycodes.com/blog/2016/05/30/creating-polymorphic-users-with-devise-and-rails">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Code by Codes" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-57179880-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Creating Polymorphic Users With Devise and Rails</h1>
        <div class="meta">
          written 








  



<time datetime="2016-05-30T21:44:36-04:00" pubdate data-updated="true">May 30, 2016</time>
          


        </div>
        <h1>Add in links for an updated template to start the project with.</h1>

<h1>create template just for the tutorial</h1>

<h1>run rake routes to see all the routes and get an idea what pages were</h1>

<h1>created</h1>

<h1>remove simple form form template and make sure everything still works</h1>

<p><a href="https://gist.github.com/043484e923f87840ca763f6b287a4bfc.git">https://gist.github.com/043484e923f87840ca763f6b287a4bfc.git</a></p>

<p>First and foremost, if you&rsquo;re not familiar with Devise, or are looking
for a good place to get some good information on getting started with
Devise, this is not the post for you.  There are a ton of great
resources, incliding the Devise documentation for getting started.</p>

<p>Today were going to be talking about building differnt types of users
that will build off Devise.  It&rsquo;s a pretty common use case, the most
common of which is some type of service provider and a customer of that
service.  In this example we&rsquo;ll be using Provider and Customer.</p>

<p>Once we&rsquo;re done, we&rsquo;ll be able to sign up users as either a Provider or
Customer, sign them in after registering, and have a single login page
regardless of the type of user.</p>

<p>To make it easy to get started, I&rsquo;ve created a template to generate a
new application for us to jump into.  If you want to know more about
creating templates, or how to create your own, check out my other post.
If you have any problems creating the template, or just prefer to fork
or clone for github, you can do that.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rails new polymorphic_users -m WHATEVER THE URL OR SETUP IS</span></code></pre></td></tr></table></div></figure>


<p>Once, you have the app up and running, lets take a look at the fields
Devise creates for the User model for us.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>irb(main):001:0&gt; user = User.new
</span><span class='line'>=&gt; #&lt;User id: nil, email: "", encrypted_password: "", reset_password_token: nil, reset_password_sent_at: nil, remember_created_at: nil, sign_in_count: 0, current_sign_in_at: nil, last_sign_in_at: nil, current_sign_in_ip: nil, last_sign_in_ip: nil, created_at: nil, updated_at: nil&gt;</span></code></pre></td></tr></table></div></figure>


<p><code>email</code>, <code>encrypted_password</code>, <code>reset_password_token</code>, <code>reset_password_sent_at</code>, <code>remember_created_at</code>, <code>sign_in_count</code>, <code>current_sign_in_at</code>, <code>last_sign_in_at</code>, <code>current_sign_in_ip</code>, <code>last_sign_in_ip</code>, <code>created_at</code>, <code>updated_at</code></p>

<p>This gives us an idea of the structure that we&rsquo;re going to build on and
think about the best way to model our Users.  To keep the code DRY,
let&rsquo;s think about what fields both types of Users will have in common.
To keep it simple, let&rsquo;s just stick with first_name and last_name.  It&rsquo;s
a pretty reasonable assumption that every user that signs up for our
site will have a first_name and last_name so there&rsquo;s no point in
duplicating those fields in the Provider and Customer tables.</p>

<h5>Create migrations for adding first_name and last_name to tables,</h5>

<h5>views, and controllers (i think adding them to the controllers, it</h5>

<h4>tricky?)</h4>

<p>First, let&rsquo;s add our new fields to the Devise User model.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rails g migration add_names_to_users first_name last_name</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s going to create a migration file that looks like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddNamesToUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have a new fields on the model, how do we add them to the
strong parameters for Devise? There are a couple ways to go about this.
You can check the recommeded way from Devise [<a href="https://github.com/plataformatec/devise#strong-parameters">https://github.com/plataformatec/devise#strong-parameters</a>]</p>

<p>But I prefer, a slightly different way.  For both ways, you&rsquo;ll need to
add a <code>before_filter</code> inside the <code>ApplicationController</code>.  This filter
will run before any action from a Devise controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">before_action</span> <span class="ss">:configure_permitted_parameters</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="ss">:devise_controller?</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s write our method that will run before each Devise action now</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">configure_permitted_parameters</span>
</span><span class='line'>    <span class="n">devise_parameter_sanitizer</span><span class="o">.</span><span class="n">for</span><span class="p">(</span><span class="ss">:sign_up</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span><span class="o">]</span>
</span><span class='line'>    <span class="n">devise_parameter_sanitizer</span><span class="o">.</span><span class="n">for</span><span class="p">(</span><span class="ss">:account_update</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>After that&rsquo;s taken care of, we can update our forms as we normally would
to add the new fields.  Here&rsquo;s what the new user form should look like
now</p>

<h1>check the formation on this, still looks crooked?</h1>

<figure class='code'><figcaption><span>app/views/devise/registrations/new.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel panel-default&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-heading&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-body&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>%= form_for(resource, :as =&gt; resource_name, :url =&gt; registration_path(resource_name)) do |f| %&gt;
</span><span class='line'>    <span class="err">&lt;</span>%= devise_error_messages! %&gt;
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :first_name %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.text_field :first_name, autofocus: true, class: &quot;form-control&quot; %&gt;
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :last_name %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.text_field :last_name, class: &quot;form-control&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :email %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.email_field :email, autofocus: true, class: &quot;form-control&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :password %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.password_field :password, class: &quot;form-control&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.submit &quot;Sign up&quot;, class: &quot;btn btn-primary&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>%= render &quot;devise/shared/links&quot; %&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>same thing goes for our <code>edit</code> page</p>

<figure class='code'><figcaption><span>app/views/devise/registrations/edit.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel panel-default&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-heading&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-title&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h1&gt;</span>Edit <span class="err">&lt;</span>%= resource_name.to_s.humanize %&gt;<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-body&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>%= form_for(resource, :as =&gt; resource_name, :url =&gt; registration_path(resource_name), :html =&gt; { :method =&gt; :put }) do |f| %&gt;
</span><span class='line'>    <span class="err">&lt;</span>%= devise_error_messages! %&gt;
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :first_name %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.text_field :first_name, class: &quot;form-control&quot;, :autofocus =&gt; true %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :last_name %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.text_field :last_name, class: &quot;form-control&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :email %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= f.email_field :email, class: &quot;form-control&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :password %&gt; <span class="nt">&lt;i&gt;</span>(leave blank if you don&#39;t want to change it)<span class="nt">&lt;/i&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.password_field :password, class: &quot;form-control&quot;, :autocomplete =&gt; &quot;off&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.label :current_password %&gt; <span class="nt">&lt;i&gt;</span>(we need your current password to confirm your changes)<span class="nt">&lt;/i&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.password_field :current_password, class: &quot;form-control&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= f.submit &quot;Update&quot;, class: &quot;btn btn-primary&quot; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h3&gt;</span>Cancel my account<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;p&gt;</span>Unhappy? <span class="err">&lt;</span>%= button_to &quot;Cancel my account&quot;, registration_path(resource_name), :data =&gt; { :confirm =&gt; &quot;Are you sure?&quot; }, :method =&gt; :delete, class: &quot;btn btn-warning&quot; %&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">&lt;</span>%= link_to &quot;Back&quot;, :back %&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before we get to creating our new types of Users, we need to make one
more change to the Devise User model.</p>

<p>Start with a new migration.  If you&rsquo;re wondering why I didn&rsquo;t add it to
the last one, I like to keep my migrations small and concise.  This
makes it easier to roll things back if you ever need to.</p>

<figure class='code'><figcaption><span>app/views/devise/registrations/edit.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>$ rails g migration add_profile_to_users profile_id:integer profile_type
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s add an index for the sake of performance.  Note, you can specify
things like creating an index when your passing in arguments to the
generator.  I always pop open my migrations to make sure I created it
correctly, and usually just add it in that way.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddProfileToUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:profile_id</span><span class="p">,</span> <span class="ss">:integer</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:profile_type</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="o">[</span><span class="ss">:meta_id</span><span class="p">,</span> <span class="ss">:meta_type</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>One last tweak to the <code>User</code> model and we&rsquo;ll be all set to get started
on our new user types.</p>

<p>Open the <code>User</code> model and add our new association that&rsquo;s going to allow
us to link our new types of users</p>

<figure class='code'><figcaption><span>app/models/user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Include default devise modules. Others available are:</span>
</span><span class='line'>  <span class="c1"># :confirmable, :lockable, :timeoutable and :omniauthable</span>
</span><span class='line'>  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have our custimizations to Devise complete, our next step is to
create our new types of users.  For the sake of simplicity, we&rsquo;re not going to be adding any fields
to the new types of users.  If you have no idea what polymorphic
relations are in Rails, take a bit to skim over the Rails guides to get
an idea.  If you dont get it, don&rsquo;t worry.  Polymophism can be a tricky
concept, especially when first setting it up but I&rsquo;ve found that it
makes much more sense after you&rsquo;ve implemented it and had a chance to
play around with it a bit. [<a href="http://guides.rubyonrails.org/association_basics.html#polymorphic-associations">http://guides.rubyonrails.org/association_basics.html#polymorphic-associations</a>]</p>

<p>If you remember, our two types of users are going to be <code>Provider</code>s and
<code>Customer</code>s.  Since both of the models are going to be pretty empty,
let&rsquo;s create them both at once</p>

<figure class='code'><figcaption><span>app/models/user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Customer</span> <span class="o">&amp;&amp;</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Provider</span>
</span></code></pre></td></tr></table></div></figure>


<p>be sure to migrate the db afterwards</p>

<figure class='code'><figcaption><span>app/models/user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have one side of our polymorphic relationship, now we need to update
the other side of it with our new User types.</p>

<figure class='code'><figcaption><span>app/models/customer.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Customer</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_one</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="n">destroy</span>
</span><span class='line'>  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:user</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/models/provider.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Provider</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_one</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">dependnet</span><span class="p">:</span> <span class="n">destroy</span>
</span><span class='line'>  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:user</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first line is filling out the other half of our relationship to the
users.  We&rsquo;re telling rails it has one <code>User</code> and <code>as: profile</code>
indicates it&rsquo;s a polymorphic relationship.  We&rsquo;ve also added <code>dependent:
destroy</code> to make sure when we delete an object, and associated objects
are deleted as well.</p>

<p>The second line we added is needed to create an associated <code>User</code>
whenever we create either a <code>Customer</code> or <code>Provider</code></p>

<p><code>accepts_nested_attributes_for</code> allow you to save attributes on associated records through the parent.
[<a href="http://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html">http://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html</a>]</p>

<p>Back to an earlier topic of strong parameters in Rails, we now need to
whitelist the attributes for the <code>User</code> inside the each of our
controllers.</p>

<p>We already have our models created, but we would still like to genrate a
lot of the boilerplate we need to create the controller and views so we
can keep plugging away at our project.  Using the rails <code>scaffold</code>
command, would create a model for whatever resource name we specify so
what are our options.  Let&rsquo;s ask for some help&hellip;</p>

<figure class='code'><figcaption><span>app/models/provider.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">generate</span> <span class="o">-</span><span class="n">h</span>
</span></code></pre></td></tr></table></div></figure>


<p>will give us a lot of options for the generate command, take a look this
section in particular</p>

<figure class='code'><figcaption><span>app/models/provider.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Please</span> <span class="n">choose</span> <span class="n">a</span> <span class="n">generator</span> <span class="n">below</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="ss">Rails</span><span class="p">:</span>
</span><span class='line'>  <span class="n">assets</span>
</span><span class='line'>  <span class="n">controller</span>
</span><span class='line'>  <span class="n">generator</span>
</span><span class='line'>  <span class="n">helper</span>
</span><span class='line'>  <span class="n">integration_test</span>
</span><span class='line'>  <span class="n">job</span>
</span><span class='line'>  <span class="n">mailer</span>
</span><span class='line'>  <span class="n">migration</span>
</span><span class='line'>  <span class="n">model</span>
</span><span class='line'>  <span class="n">resource</span>
</span><span class='line'>  <span class="n">responders_controller</span>
</span><span class='line'>  <span class="n">scaffold</span>
</span><span class='line'>  <span class="n">scaffold_controller</span>
</span><span class='line'>  <span class="n">task</span>
</span></code></pre></td></tr></table></div></figure>


<p>Take a look at <code>scaffold_controller</code>  here&rsquo;s what it does:</p>

<blockquote><p>Stubs out a scaffolded controller and its views. Pass the model name, either CamelCased or under_scored, and a list of views as arguments. The controller name is retrieved as a pluralized version of the model name.  To create a controller within a modulespecify the model name as a path like &lsquo;parent_module/controller_name&rsquo;.  This generates a controller class in app/controllers and invokes helper, template engine and test framework generators.</p></blockquote>

<p>Running:</p>

<figure class='code'><figcaption><span>app/models/provider.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">scaffold_controller</span> <span class="no">Customer</span>
</span></code></pre></td></tr></table></div></figure>


<p>and</p>

<figure class='code'><figcaption><span>app/models/provider.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">scaffold_controller</span> <span class="no">Provider</span>
</span></code></pre></td></tr></table></div></figure>


<p>will scaffold a controller with all our RESTful routes along with
their associated views.  If you look at the created files, there weren&rsquo;t
and migrations or changes to the model, just our controllers and views.</p>

<p>However, we do have to specify our routes, so let&rsquo;s add those in now:</p>

<figure class='code'><figcaption><span>config/routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">resources</span> <span class="ss">:customers</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:providers</span>
</span></code></pre></td></tr></table></div></figure>


<h2>look into removing simple form to keep things simple  - remove from</h2>

<h2>template and streamline forms</h2>

<h1>work on controllers and building user - form showing blank right now.</h1>

<h1>link for info on bulding user</h1>

<h1><a href="http://stackoverflow.com/questions/783584/ruby-on-rails-how-do-i-use-the-active-record-build-method-in-a-belongs-to-rel">http://stackoverflow.com/questions/783584/ruby-on-rails-how-do-i-use-the-active-record-build-method-in-a-belongs-to-rel</a></h1>

<p>With our routes set up, let&rsquo;s update both of our forms to collect the
signup info from our user.</p>

<figure class='code'><figcaption><span>app/views/customers/_form.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="err">&lt;</span>%= form_for(@customer) do |f| %&gt;
</span><span class='line'>  <span class="err">&lt;</span>% if @customer.errors.any? %&gt;
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;error_explanation&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= pluralize(@customer.errors.count, &quot;error&quot;) %&gt; prohibited this customer from being saved:<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>% @customer.errors.full_messages.each do |message| %&gt;
</span><span class='line'>          <span class="nt">&lt;li&gt;</span><span class="err">&lt;</span>%= message %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>      <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;panel-body&quot;</span> <span class="na">style=</span><span class="s">&quot;text-align: center;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>%= f.fields_for :user do |u| %&gt;
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.label :first_name %&gt;<span class="nt">&lt;br&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.text_field :first_name, class: &#39;form-control&#39; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.label :last_name %&gt;<span class="nt">&lt;br&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.text_field :last_name, class: &#39;form-control&#39; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.label :email %&gt;<span class="nt">&lt;br&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.email_field :email, class: &#39;form-control&#39; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.label :password %&gt;<span class="nt">&lt;br&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= u.password_field :password, class: &#39;form-control&#39; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span> <span class="na">style=</span><span class="s">&quot;margin: 10px 0px; text-align: center;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="err">&lt;</span>%= f.submit &quot;Submit&quot;, :class=&gt;&quot;btn btn-info&quot; %&gt;
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">&lt;</span>% if request.path == new_customer_path %&gt;
</span><span class='line'>      <span class="err">&lt;</span>%= link_to &quot;Log in&quot;, new_user_session_path %&gt;<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span>% end %&gt;
</span></code></pre></td></tr></table></div></figure>


<p>This may look a little odd because asll the elements listed in the form
are nested.  This is becasue right now, we dont have any fields specific
to the Customer.  When you add your own elements to the
Customer/Provider, it will look something like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="err">&lt;</span>%= f.label :home_address %&gt;
</span><span class='line'><span class="err">&lt;</span>%= f.text_field :home_address %&gt;
</span><span class='line'>
</span><span class='line'>  <span class="err">&lt;</span>%= f.fields_for :user do |u| %&gt;
</span><span class='line'>    ...
</span><span class='line'>  <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>
</span><span class='line'>  ...
</span><span class='line'><span class="err">&lt;</span>% end %&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Go ahead and do the same thing with the <code>Provider</code> form as well.  Once that&rsquo;s
complete, we&rsquo;re ready to start doing work on our forms now.</p>

<p>If you look at your forms on the front end.  Unless you added attributes
for either the Provider or Customer, you wont see any fields.  This is
because right now, we havn&rsquo;t done anyhting to build a <code>User</code> to go along
with the association we&rsquo;re trying to create.</p>

<p>Build the associated user inside you <code>#new</code> method so it&rsquo;s available to
the form.</p>

<figure class='code'><figcaption><span>app/controllers/customers_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>    <span class="vi">@customer</span> <span class="o">=</span> <span class="no">Customer</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="vi">@customer</span><span class="o">.</span><span class="n">build_user</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>and to allow user updates to be allowed through our <code>Customer</code> model, we
need to add those to our strong params.</p>

<figure class='code'><figcaption><span>app/controllers/customers_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">customer_params</span>
</span><span class='line'>  <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:customer</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">user_attributes</span><span class="p">:</span> <span class="o">[</span><span class="ss">:first_name</span><span class="p">,</span>
</span><span class='line'>                                                     <span class="ss">:last_name</span><span class="p">,</span>
</span><span class='line'>                                                     <span class="ss">:email</span><span class="p">,</span>
</span><span class='line'>                                                     <span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you go to the <code>new_customer_path</code>, we can create a new Customer
and User at the same time, and get redirected to the <code>show</code> view for the
customer we just created.  If you look in the top corner of the nav bar,
we still see the Sign In link.  We need to make one more update to
create a new Customer, create and associated User, and create a new
session for the user we just created.  This sounds a lot more
complicated than it actually is.  Devise give us a very handy <code>sign_in</code>
method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># POST /customers</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="vi">@customer</span> <span class="o">=</span> <span class="no">Customer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">customer_params</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@customer</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Customer was successfully created.&#39;</span>
</span><span class='line'>      <span class="n">sign_in</span><span class="p">(</span><span class="vi">@customer</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="vi">@customer</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">render</span> <span class="ss">:new</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>and that&rsquo;s that!  Now, when you go to create a new <code>Customer</code> or
<code>Provider</code>, we automatically create an associated <code>User</code> and sign in.
One of my favorite things about this set up is you, can use single form
to sign in at the <code>new_user_session GET    /users/sign_in(.:format)       devise/sessions#new</code> path.</p>

        <a href="https://twitter.com/share" class="twitter-share-button" data-via="cnorm35" data-size="large">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>
        <hr class="divider-short"/>

        
        <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        </section>
        
      </div>
    </div>
  </div>
</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/blog/2015/08/31/creating-a-simeple-twitter-bot-with-ruby/" title="Previous Post: Creating a Simple Twitter Bot with Ruby">&laquo; Previous: Creating a Simple Twitter Bot with Ruby</a>
        

        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/cnorm35"><i class="fa fa-twitter-square fa-2x"></i></a>
    

    
    <a href="https://github.com/cnorm35"><i class="fa fa-github fa-2x"></i></a>
    

    

    
    <a href="mailto:wcodynorman@gmail.com"><i class="fa fa-envelope-o fa-2x"></i></a>
    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
      

<script type="text/javascript">
      var disqus_shortname = 'codebycodes';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.codebycodes.com/blog/2016/05/30/creating-polymorphic-users-with-devise-and-rails/';
        var disqus_url = 'http://www.codebycodes.com/blog/2016/05/30/creating-polymorphic-users-with-devise-and-rails/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


    
    

<script type="text/javascript">
      var disqus_shortname = 'codebycodes';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.codebycodes.com/blog/2016/05/30/creating-polymorphic-users-with-devise-and-rails/';
        var disqus_url = 'http://www.codebycodes.com/blog/2016/05/30/creating-polymorphic-users-with-devise-and-rails/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57179880-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
